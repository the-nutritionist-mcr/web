import { AuthenticationServiceContext } from '@tnmw/components';
import { LoadingContext } from 'libs/components/src/molecules/loading';
import { ReactNode, useContext, useEffect, useState } from 'react';

import {
  confirmSignup,
  currentUser,
  login,
  newPasswordChallengeResponse,
  forgotPassword,
  register,
  signOut,
} from '../aws/authenticate';

const authenticationService = {
  login,
  register,
  signOut,
  confirmSignup,
  forgotPassword,
  newPasswordChallengeResponse,
};

interface AuthenticationProvider {
  children: ReactNode;
}

const LOADING_KEY = 'get-user';

const AuthenticationProvider = (props: AuthenticationProvider) => {
  const { startLoading, stopLoading } = useContext(LoadingContext);
  const [user, setUser] = useState();
  useEffect(() => {
    (async () => {
      startLoading(LOADING_KEY);
      const user = await currentUser();
      stopLoading(LOADING_KEY);
    })();
  }, []);
  return (
    <AuthenticationServiceContext.Provider value={authenticationService}>
      {props.children}
    </AuthenticationServiceContext.Provider>
  );
};
